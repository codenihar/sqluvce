CREATE TABLE DEPARTMENT
(
  DNo INT PRIMARY KEY,
  DName VARCHAR(100),
  MgrSSN VARCHAR(10),
  MgrStartDate DATE
);


CREATE TABLE EMPLOYEE
(
  SSN VARCHAR(10) PRIMARY KEY,
  Name VARCHAR(100),
  Address VARCHAR(200),
  Sex CHAR(1),
  Salary DECIMAL(10, 2),
  SuperSSN VARCHAR(10),
  DNo INT,
  FOREIGN KEY (DNo) REFERENCES DEPARTMENT(DNo)
);


CREATE TABLE DLOCATION
(
  DNo INT,
  DLoc VARCHAR(100),
  FOREIGN KEY (DNo) REFERENCES DEPARTMENT(DNo)
);


CREATE TABLE PROJECT
(
  PNo INT PRIMARY KEY,
  PName VARCHAR(100),
  PLocation VARCHAR(100),
  DNo INT,
  FOREIGN KEY (DNo) REFERENCES DEPARTMENT(DNo)
);


CREATE TABLE WORKS_ON
(
  SSN VARCHAR(10),
  PNo INT,
  Hours DECIMAL(5, 2),
  FOREIGN KEY (SSN) REFERENCES EMPLOYEE(SSN),
  FOREIGN KEY (PNo) REFERENCES PROJECT(PNo)
);
  SELECT DISTINCT P.PNo
  FROM PROJECT P
    JOIN WORKS_ON W ON P.PNo = W.PNo
    JOIN EMPLOYEE E ON W.SSN = E.SSN
  WHERE E.Name LIKE '%Scott%'
UNION
  SELECT DISTINCT P.PNo
  FROM PROJECT P
    JOIN DEPARTMENT D ON P.DNo = D.DNo
    JOIN EMPLOYEE E ON D.MgrSSN = E.SSN
  WHERE E.Name LIKE '%Scott%';
SELECT E.SSN, E.Name, (E.Salary * 1.10) AS NewSalary
FROM EMPLOYEE E
  JOIN WORKS_ON W ON E.SSN = W.SSN
  JOIN PROJECT P ON W.PNo = P.PNo
WHERE P.PName = 'IoT';
SELECT SUM(Salary) AS TotalSalary, MAX(Salary) AS MaxSalary,
  MIN(Salary) AS MinSalary, AVG(Salary) AS AvgSalary
FROM EMPLOYEE
WHERE DNo = (SELECT DNo
FROM DEPARTMENT
WHERE DName = 'Accounts');


SELECT E.Name
FROM EMPLOYEE E
WHERE NOT EXISTS (
  SELECT P.PNo
FROM PROJECT P
WHERE P.DNo = 5 AND NOT EXISTS (
    SELECT *
  FROM WORKS_ON W
  WHERE W.SSN = E.SSN AND W.PNo = P.PNo
  )
);
SELECT D.DNo, COUNT(*) AS NumHighEarningEmployees
FROM EMPLOYEE E
  JOIN DEPARTMENT D ON E.DNo = D.DNo
WHERE E.Salary > 600000
GROUP BY D.DNo
HAVING COUNT(*) > 5;



